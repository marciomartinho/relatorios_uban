{% extends "base_relatorio.html" %}

{% block titulo %}Balanço Orçamentário da Despesa{% endblock %}

{% block titulo_relatorio %}BALANÇO ORÇAMENTÁRIO DA DESPESA{% endblock %}

{% block conteudo %}
<table>
    <thead>
        <tr>
            <th rowspan="2">DESPESAS ORÇAMENTÁRIAS</th>
            <th colspan="2">DOTAÇÃO</th>
            <th colspan="3">DESPESAS</th>
            <th rowspan="2">SALDO DA<br>DOTAÇÃO</th>
        </tr>
        <tr>
            <th>INICIAL</th>
            <th>ATUALIZADA</th>
            <th>EMPENHADA</th>
            <th>LIQUIDADA</th>
            <th>PAGA</th>
        </tr>
    </thead>
    <tbody>
        {% for linha in dados_relatorio %}
            <tr class="{{ linha.tipo }}">
                <td>{{ linha.especificacao }}</td>
                <td>{{ linha.dotacao_inicial_fmt }}</td>
                <td>{{ linha.dotacao_atualizada_fmt }}</td>
                <td>{{ linha.despesa_empenhada_fmt }}</td>
                <td>{{ linha.despesa_liquidada_fmt }}</td>
                <td>{{ linha.despesa_paga_fmt }}</td>
                <td class="{% if linha.saldo_dotacao < 0 %}valor-negativo{% endif %}">
                    {{ linha.saldo_dotacao_fmt }}
                </td>
            </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}

{% block scripts %}
<script>
    // Dados para o PDF
    const dadosPDF = {{ dados_pdf | tojson | safe }};
    const tiposLinhas = {{ dados_relatorio | map(attribute='tipo') | list | tojson | safe }};
    
    // Configurar botão de PDF
    document.getElementById('btn-pdf').addEventListener('click', () => {
        RelatorioUtils.gerarPDF({
            titulo: 'Balanço Orçamentário da Despesa',
            subtitulo: 'Exercício 2025 - {{ mes_ref }}/2025',
            dados: dadosPDF,
            nomeArquivo: 'balanco-orcamentario-despesa.pdf',
            colunasTipos: tiposLinhas,
            orientacao: 'l' // Landscape para caber mais colunas
        });
    });
</script>
{% endblock %}